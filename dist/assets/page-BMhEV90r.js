import{r as i,j as e,u as $,L as D}from"./index-C14qO_Yc.js";import{s as o,L as B}from"./Logo26Building-Dw_S6NdE.js";const P=({isOpen:j,onClose:N,onSave:_,notice:n,mode:d})=>{const[t,m]=i.useState({title:"",content:"",is_important:!1,is_published:!0}),[l,p]=i.useState(!1),[c,h]=i.useState("");i.useEffect(()=>{j&&(m(d==="edit"&&n?{title:n.title,content:n.content,is_important:n.is_important,is_published:n.is_published}:{title:"",content:"",is_important:!1,is_published:!0}),h(""))},[j,d,n]);const b=async a=>{if(a.preventDefault(),!t.title.trim()){h("제목을 입력해주세요.");return}if(!t.content.trim()){h("내용을 입력해주세요.");return}try{p(!0),h("");const{data:{user:u}}=await o.auth.getUser();if(!u)throw new Error("사용자 인증이 필요합니다.");if(d==="create"){const{error:x}=await o.from("notices").insert({title:t.title.trim(),content:t.content.trim(),author_id:u.id,is_important:t.is_important,is_published:t.is_published});if(x)throw x}else if(d==="edit"&&n){const{error:x}=await o.from("notices").update({title:t.title.trim(),content:t.content.trim(),is_important:t.is_important,is_published:t.is_published,updated_at:new Date().toISOString()}).eq("id",n.id);if(x)throw x}_(),N()}catch(u){console.error("공지사항 저장 오류:",u),h(u instanceof Error?u.message:"저장에 실패했습니다.")}finally{p(!1)}},y=()=>{l||N()};return j?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] transform transition-all duration-300 scale-100 flex flex-col",children:[e.jsx("div",{className:"bg-blue-500 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:d==="create"?"새 공지사항 작성":"공지사항 수정"}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:d==="create"?"새로운 공지사항을 작성하세요":"공지사항을 수정하세요"})]}),e.jsx("button",{onClick:y,disabled:l,className:"text-white hover:text-gray-200 transition-colors disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:["제목 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",value:t.title,onChange:a=>m({...t,title:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",placeholder:"공지사항 제목을 입력하세요",disabled:l,maxLength:255}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.title.length,"/255"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:["내용 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"content",value:t.content,onChange:a=>m({...t,content:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 resize-none",placeholder:"공지사항 내용을 입력하세요",rows:12,disabled:l}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"줄바꿈은 자동으로 적용됩니다."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"is_important",checked:t.is_important,onChange:a=>m({...t,is_important:a.target.checked}),className:"w-5 h-5 text-red-600 border-gray-300 rounded focus:ring-red-500",disabled:l}),e.jsxs("label",{htmlFor:"is_important",className:"text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"ri-fire-line text-red-500 mr-1"}),"중요 공지사항"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"is_published",checked:t.is_published,onChange:a=>m({...t,is_published:a.target.checked}),className:"w-5 h-5 text-green-600 border-gray-300 rounded focus:ring-green-500",disabled:l}),e.jsxs("label",{htmlFor:"is_published",className:"text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"ri-eye-line text-green-500 mr-1"}),"즉시 발행"]})]})]}),c&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700 text-sm",children:c})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"미리보기"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_important&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("i",{className:"ri-fire-line mr-1"}),"중요"]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.is_published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.is_published?"발행됨":"임시저장"})]}),e.jsx("h4",{className:"font-semibold text-gray-900",children:t.title||"제목을 입력하세요"}),e.jsx("p",{className:"text-gray-600 text-sm whitespace-pre-wrap",children:t.content||"내용을 입력하세요"})]})]})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 rounded-b-2xl",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:y,disabled:l,className:"flex-1 px-4 py-3 text-gray-600 bg-white border border-gray-300 hover:bg-gray-50 rounded-xl font-medium transition-colors duration-200 disabled:opacity-50",children:"취소"}),e.jsx("button",{type:"submit",onClick:b,disabled:l,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:transform-none flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line"}),d==="create"?"작성하기":"수정하기"]})})]})})]})}):null};function W(){const[j,N]=i.useState(null),[_,n]=i.useState(null),[d,t]=i.useState([]),[m,l]=i.useState(!0),[p,c]=i.useState(""),[h,b]=i.useState(!1),[y,a]=i.useState(!1),[u,x]=i.useState(null),[E,v]=i.useState(!1),[g,w]=i.useState(null),k=$();i.useEffect(()=>{M()},[]);const M=async()=>{try{const{data:{user:s}}=await o.auth.getUser();if(!s){k("/login");return}N(s);const{data:r,error:L}=await o.from("profiles").select("*").eq("id",s.id).single();if(L)throw L;if(n(r),!r?.is_admin){c("관리자 권한이 필요합니다.");return}await f()}catch(s){console.error("사용자 확인 오류:",s),c("사용자 정보를 확인하는데 실패했습니다.")}finally{l(!1)}},f=async()=>{try{const{data:s,error:r}=await o.from("notices").select(`
          *,
          profiles (
            name,
            email
          )
        `).order("is_important",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;t(s||[])}catch(s){console.error("공지사항 로딩 오류:",s),c("공지사항을 불러오는데 실패했습니다.")}},C=()=>{x(null),b(!0)},F=s=>{x(s),a(!0)},O=s=>{w(s),v(!0)},q=async()=>{if(g)try{const{error:s}=await o.from("notices").delete().eq("id",g.id);if(s)throw s;await f(),v(!1),w(null)}catch(s){console.error("공지사항 삭제 오류:",s),c("공지사항 삭제에 실패했습니다.")}},I=async s=>{try{const{error:r}=await o.from("notices").update({is_important:!s.is_important}).eq("id",s.id);if(r)throw r;await f()}catch(r){console.error("중요도 변경 오류:",r),c("중요도 변경에 실패했습니다.")}},z=async s=>{try{const{error:r}=await o.from("notices").update({is_published:!s.is_published}).eq("id",s.id);if(r)throw r;await f()}catch(r){console.error("발행 상태 변경 오류:",r),c("발행 상태 변경에 실패했습니다.")}},S=s=>new Date(s).toLocaleDateString("ko-KR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=async()=>{await o.auth.signOut(),k("/")};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})})}):p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:p}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200",children:"새로고침"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx(D,{to:"/",className:"flex items-center space-x-3",children:e.jsx(B,{size:40})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(D,{to:"/admin",className:"text-gray-600 hover:text-gray-900 font-medium",children:"관리자 대시보드"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("span",{className:"text-gray-600",children:_?.name||"관리자"}),e.jsx("button",{onClick:U,className:"text-red-600 hover:text-red-700 font-medium",children:"로그아웃"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"공지사항 관리"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"공지사항을 작성, 수정, 삭제할 수 있습니다."})]}),e.jsxs("button",{onClick:C,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2",children:[e.jsx("i",{className:"ri-add-line"}),"새 공지사항"]})]}),e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-notification-line text-6xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"공지사항이 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"새로운 공지사항을 작성해보세요."}),e.jsx("button",{onClick:C,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200",children:"첫 공지사항 작성"})]}):d.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.is_important&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("i",{className:"ri-fire-line mr-1"}),"중요"]}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.is_published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.is_published?"발행됨":"임시저장"}),e.jsx("span",{className:"text-sm text-gray-500",children:S(s.created_at)}),s.profiles&&e.jsxs("span",{className:"text-sm text-gray-500",children:["by ",s.profiles.name]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:s.title}),e.jsxs("p",{className:"text-gray-600 line-clamp-3 mb-4",children:[s.content.replace(/<[^>]*>/g,"").substring(0,200),s.content.length>200&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-eye-line"}),e.jsxs("span",{children:["조회 ",s.view_count]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-time-line"}),e.jsxs("span",{children:["수정 ",S(s.updated_at)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsx("button",{onClick:()=>I(s),className:`p-2 rounded-lg transition-colors duration-200 ${s.is_important?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:s.is_important?"중요 해제":"중요 표시",children:e.jsx("i",{className:"ri-fire-line"})}),e.jsx("button",{onClick:()=>z(s),className:`p-2 rounded-lg transition-colors duration-200 ${s.is_published?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:s.is_published?"발행 취소":"발행하기",children:e.jsx("i",{className:s.is_published?"ri-eye-line":"ri-eye-off-line"})}),e.jsx("button",{onClick:()=>F(s),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors duration-200",title:"수정",children:e.jsx("i",{className:"ri-edit-line"})}),e.jsx("button",{onClick:()=>O(s),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors duration-200",title:"삭제",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]})},s.id))})]})}),E&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all duration-300 scale-100",children:[e.jsx("div",{className:"bg-red-500 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"공지사항 삭제"}),e.jsx("p",{className:"text-red-100 text-sm mt-1",children:g.title})]}),e.jsx("button",{onClick:()=>{v(!1),w(null)},className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"정말로 이 공지사항을 삭제하시겠습니까?"}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"제목:"})," ",g.title,e.jsx("br",{}),e.jsx("strong",{children:"상태:"})," ",g.is_published?"발행됨":"임시저장",e.jsx("br",{}),e.jsx("strong",{children:"중요도:"})," ",g.is_important?"중요":"일반"]})}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"⚠️ 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{v(!1),w(null)},className:"flex-1 px-4 py-3 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors duration-200",children:"취소"}),e.jsx("button",{onClick:q,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-all duration-200 transform hover:scale-105",children:"삭제"})]})]})]})}),e.jsx(P,{isOpen:h||y,onClose:()=>{b(!1),a(!1),x(null)},onSave:f,notice:u,mode:h?"create":"edit"})]})}export{W as default};
