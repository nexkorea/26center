import{r as n,u as _,j as e,L as c}from"./index-B-m7kj40.js";import{s as d,L as E}from"./Logo26Building-Cp1WG6XV.js";function z(){const[L,p]=n.useState(null),[h,f]=n.useState(null),[y,j]=n.useState(!0),[a,b]=n.useState(!1),[m,i]=n.useState(""),x=_(),[s,g]=n.useState({title:"",content:"",category:"",priority:"normal",is_anonymous:!1}),v=[{value:"facility",label:"시설 관련"},{value:"security",label:"보안 관련"},{value:"noise",label:"소음 관련"},{value:"parking",label:"주차 관련"},{value:"elevator",label:"엘리베이터"},{value:"cleaning",label:"청소 관련"},{value:"management",label:"관리사무소"},{value:"other",label:"기타"}],N=[{value:"low",label:"낮음",color:"text-green-600"},{value:"normal",label:"보통",color:"text-blue-600"},{value:"high",label:"높음",color:"text-orange-600"},{value:"urgent",label:"긴급",color:"text-red-600"}];n.useEffect(()=>{w()},[]);const w=async()=>{try{const{data:{user:t}}=await d.auth.getUser();if(!t){x("/login");return}p(t);const{data:r,error:l}=await d.from("profiles").select("*").eq("id",t.id).single();if(l)throw l;f(r)}catch(t){console.error("사용자 확인 오류:",t),i("사용자 정보를 확인하는데 실패했습니다.")}finally{j(!1)}},o=t=>{const{name:r,value:l,type:S}=t.target;if(S==="checkbox"){const u=t.target.checked;g(F=>({...F,[r]:u}))}else g(u=>({...u,[r]:l}))},k=async t=>{if(t.preventDefault(),!s.title.trim()){i("제목을 입력해주세요.");return}if(!s.content.trim()){i("내용을 입력해주세요.");return}if(!s.category){i("민원 분류를 선택해주세요.");return}try{b(!0),i("");const{data:{user:r}}=await d.auth.getUser();if(!r)throw new Error("사용자 인증이 필요합니다.");const{error:l}=await d.from("complaints").insert({user_id:r.id,title:s.title.trim(),content:s.content.trim(),category:s.category,priority:s.priority,is_anonymous:s.is_anonymous,status:"pending"});if(l)throw l;alert("민원이 성공적으로 접수되었습니다."),x("/complaints")}catch(r){console.error("민원 접수 오류:",r),i(r instanceof Error?r.message:"민원 접수에 실패했습니다.")}finally{b(!1)}},C=async()=>{await d.auth.signOut(),x("/")};return y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})})}):m&&!h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200",children:"새로고침"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx(c,{to:"/",className:"flex items-center space-x-3",children:e.jsx(E,{size:40})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(c,{to:"/complaints",className:"text-gray-600 hover:text-gray-900 font-medium",children:"민원목록"}),e.jsx(c,{to:"/dashboard",className:"text-gray-600 hover:text-gray-900 font-medium",children:"대시보드"}),e.jsx(c,{to:"/",className:"text-gray-600 hover:text-gray-900 font-medium",children:"홈으로"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("span",{className:"text-gray-600",children:h?.name||"사용자"}),e.jsx("button",{onClick:C,className:"text-red-600 hover:text-red-700 font-medium",children:"로그아웃"})]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"민원접수"}),e.jsx("p",{className:"text-gray-600",children:"26빌딩 관련 민원을 접수해주세요."})]}),m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700 text-sm",children:m})]})}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:["제목 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:o,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",placeholder:"민원 제목을 입력하세요",disabled:a,maxLength:255}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.title.length,"/255"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-2",children:["민원 분류 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"category",name:"category",value:s.category,onChange:o,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",disabled:a,children:[e.jsx("option",{value:"",children:"분류를 선택하세요"}),v.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-2",children:"우선순위"}),e.jsx("select",{id:"priority",name:"priority",value:s.priority,onChange:o,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200",disabled:a,children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:["민원 내용 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"content",name:"content",value:s.content,onChange:o,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 resize-none",placeholder:"민원 내용을 자세히 입력해주세요",rows:8,disabled:a}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"구체적인 내용을 입력해주시면 더 빠른 처리가 가능합니다."})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"is_anonymous",name:"is_anonymous",checked:s.is_anonymous,onChange:o,className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500",disabled:a}),e.jsx("label",{htmlFor:"is_anonymous",className:"text-sm font-medium text-gray-700",children:"익명으로 접수하기"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(c,{to:"/complaints",className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors duration-200",children:"취소"}),e.jsx("button",{type:"submit",disabled:a||!s.title.trim()||!s.content.trim()||!s.category,className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"접수 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-send-plane-line"}),"민원 접수"]})})]})]})]})})]})}export{z as default};
