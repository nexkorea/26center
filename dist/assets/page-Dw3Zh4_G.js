import{r as n,u as C,j as e,L as j}from"./index-BtO8Pqls.js";import{L,s as l}from"./Logo26Building-CPhF6ata.js";function D(){const[t,N]=n.useState({email:"",password:""}),[u,p]=n.useState(!1),[x,i]=n.useState(""),[v,h]=n.useState(!1),[f,g]=n.useState(""),b=C(),S=async r=>{r.preventDefault(),p(!0),i("");try{const{data:s,error:d}=await l.auth.signInWithPassword({email:t.email,password:t.password});if(d)throw d.message.includes("Email not confirmed")?(h(!0),new Error("이메일 인증이 완료되지 않았습니다. 이메일을 확인해주세요.")):d;if(s.user){const{data:a}=await l.from("profiles").select("*").eq("id",s.user.id).single(),m=s.user.user_metadata?.name||(s.user.email||"").split("@")[0]||"사용자",c=s.user.user_metadata?.phone||null;if(a){const o=!a.name&&m,y=!a.phone&&c;(o||y)&&await l.from("profiles").update({name:o?m:a.name,phone:y?c:a.phone,updated_at:new Date().toISOString()}).eq("id",s.user.id)}else{const{error:o}=await l.from("profiles").upsert({id:s.user.id,name:m,email:s.user.email,phone:c,role:"user"},{onConflict:"id"});if(o&&!String(o.message||"").includes("duplicate key"))throw o}const k=a?.role||"user";b(k==="admin"?"/admin":"/dashboard")}}catch(s){i(s.message||"로그인에 실패했습니다.")}finally{p(!1)}},w=r=>{N({...t,[r.target.name]:r.target.value})},E=async()=>{try{g(""),i("");const{error:r}=await l.auth.resend({type:"signup",email:t.email});if(r)throw r;g("인증 이메일이 재전송되었습니다. 이메일을 확인해주세요."),h(!1)}catch(r){i(r.message||"이메일 전송에 실패했습니다.")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx(j,{to:"/",className:"flex justify-center items-center",children:e.jsx(L,{size:48})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:"로그인"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["또는"," ",e.jsx(j,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500 cursor-pointer",children:"새 계정 만들기"})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[x&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:[e.jsx("p",{children:x}),v&&e.jsx("button",{type:"button",onClick:E,className:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"인증 이메일 재전송"})]}),f&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md text-sm",children:f}),e.jsxs("form",{className:"space-y-6",onSubmit:S,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"이메일 주소"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:t.email,onChange:w,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"이메일을 입력하세요"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"비밀번호"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t.password,onChange:w,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"비밀번호를 입력하세요"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer whitespace-nowrap disabled:opacity-50",children:u?"로그인 중...":"로그인"})})]})]})})]})}export{D as default};
