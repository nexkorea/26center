import{a as T,u as A,b as R,r as i,j as e,L as o}from"./index-BtO8Pqls.js";import{s as m,L as $}from"./Logo26Building-CPhF6ata.js";import{A as O}from"./AdminNotesModal-6FCO2-J6.js";function B(){const{id:c}=T(),j=A();R();const[s,f]=i.useState(null),[P,y]=i.useState(null),[v,b]=i.useState(!0),[g,h]=i.useState(""),[d,w]=i.useState(!1),[N,p]=i.useState(!1),[n,u]=i.useState(null);i.useEffect(()=>{c&&_()},[c]);const _=async()=>{try{const{data:{user:t}}=await m.auth.getUser();if(!t){j("/login");return}const{data:a}=await m.from("profiles").select("role").eq("id",t.id).single(),r=a?.role==="admin";w(r),await k(t.id,r)}catch(t){console.error("Error checking user:",t),h("사용자 인증에 실패했습니다."),b(!1)}},k=async(t,a)=>{try{console.log("Loading move-in card:",{id:c,userId:t,isUserAdmin:a});let r=m.from("move_in_cards").select(`
          *,
          profiles(name, email, phone)
        `).eq("id",c);a||(r=r.eq("user_id",t));const{data:l,error:x}=await r.single();if(console.log("Query result:",{data:l,error:x}),x)throw console.error("Database error:",x),x.code==="PGRST116"?new Error("입주카드를 찾을 수 없습니다."):x;if(!l)throw new Error("입주카드를 찾을 수 없습니다.");console.log("Move-in card loaded successfully:",l),f(l),y(l.profiles)}catch(r){console.error("Error loading move-in card:",r),h(r.message||"입주카드를 불러오는데 실패했습니다.")}finally{b(!1)}},S=t=>{switch(t){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";case"pending":default:return"bg-yellow-100 text-yellow-800 border-yellow-200"}},C=t=>{switch(t){case"approved":return"승인됨";case"rejected":return"반려됨";case"pending":default:return"대기중"}},L=t=>{switch(t){case"owner":return"소유주";case"tenant":return"임차인";case"other":return"기타";default:return"미분류"}},q=t=>{switch(t){case"owner":return"ri-home-4-line";case"tenant":return"ri-building-line";case"other":return"ri-question-line";default:return"ri-question-line"}},E=async(t,a,r)=>{try{const{error:l}=await m.from("move_in_cards").update({status:a,admin_notes:r||null,updated_at:new Date().toISOString()}).eq("id",t);if(l)throw l;j("/admin")}catch(l){console.error("Error updating status:",l),h("상태 업데이트에 실패했습니다.")}},D=t=>{u({...t,action:"approve"}),p(!0)},I=t=>{u({...t,action:"reject"}),p(!0)},M=t=>{if(n){const a=n.action;E(n.id,a==="approve"?"approved":"rejected",t)}};return v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-4xl text-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"입주카드를 불러오는 중..."})]})}):g||!s?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"오류 발생"}),e.jsx("p",{className:"text-gray-600 mb-4",children:g||"입주카드를 찾을 수 없습니다."}),e.jsxs("div",{className:"text-sm text-gray-500 mb-6",children:[e.jsxs("p",{children:["• 입주카드 ID: ",c]}),e.jsx("p",{children:"• 권한이 없거나 입주카드가 존재하지 않을 수 있습니다."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(o,{to:"/dashboard",className:"inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{children:"대시보드로 돌아가기"})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center space-x-2 px-6 py-3 bg-gray-600 text-white rounded-xl hover:bg-gray-700 transition-colors",children:[e.jsx("i",{className:"ri-refresh-line"}),e.jsx("span",{children:"새로고침"})]})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(o,{to:"/",className:"flex items-center",children:e.jsx($,{size:40})}),e.jsx("span",{className:"hidden sm:block text-gray-400",children:"|"}),e.jsx("span",{className:"hidden sm:block text-gray-600 font-medium",children:"입주카드 상세"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(o,{to:d?"/admin":"/dashboard",className:"text-gray-600 hover:text-gray-900 transition-colors flex items-center space-x-1",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{className:"hidden sm:inline",children:d?"관리자 페이지":"대시보드"})]})})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.company_name}),e.jsx("p",{className:"text-blue-100",children:s.business_type})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full text-sm font-medium border ${S(s.status)}`,children:[e.jsx("i",{className:"ri-checkbox-circle-line mr-2"}),C(s.status)]}),e.jsxs("p",{className:"text-blue-100 text-sm mt-2",children:["신청일: ",new Date(s.created_at).toLocaleDateString("ko-KR")]})]})]})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-building-line mr-3 text-blue-600"}),"회사 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"회사명"}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.company_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"업종"}),e.jsx("p",{className:"text-gray-900",children:s.business_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"직원 수"}),e.jsxs("p",{className:"text-gray-900",children:[s.employee_count,"명"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-map-pin-line mr-3 text-blue-600"}),"입주 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"입주자 유형"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:`${q(s.tenant_type||"tenant")} text-blue-600`}),e.jsx("span",{className:"text-gray-900 font-medium",children:L(s.tenant_type||"tenant")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"층수"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:[s.floor_number,"층"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"호수"}),e.jsxs("p",{className:"text-gray-900",children:[s.room_number,"호"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"입주 예정일"}),e.jsx("p",{className:"text-gray-900",children:new Date(s.move_in_date).toLocaleDateString("ko-KR")})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-user-line mr-3 text-blue-600"}),"담당자 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"담당자명"}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.contact_person})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"연락처"}),e.jsx("p",{className:"text-gray-900",children:s.contact_phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"이메일"}),e.jsx("p",{className:"text-gray-900",children:s.contact_email})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-car-line mr-3 text-blue-600"}),"주차 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"주차 필요"}),e.jsx("p",{className:"text-gray-900",children:s.parking_needed?e.jsxs("span",{className:"inline-flex items-center text-green-600",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"필요함"]}):e.jsxs("span",{className:"inline-flex items-center text-gray-500",children:[e.jsx("i",{className:"ri-close-line mr-1"}),"불필요"]})})]}),s.parking_needed&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"주차 공간 수"}),e.jsxs("p",{className:"text-gray-900",children:[s.parking_count,"개"]})]}),s.parking_needed&&s.vehicle_numbers&&s.vehicle_numbers.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"등록된 차량번호"}),e.jsx("div",{className:"space-y-2",children:(s.vehicle_numbers||[]).map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[a+1,"번"]}),e.jsx("span",{className:"text-gray-900 font-mono",children:t})]},a))})]})]})]})]}),s.special_requests&&e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center mb-4",children:[e.jsx("i",{className:"ri-message-3-line mr-3 text-blue-600"}),"특별 요청사항"]}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-6",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:s.special_requests})})]}),s.admin_notes&&e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center mb-4",children:[e.jsx("i",{className:"ri-admin-line mr-3 text-blue-600"}),"관리자 메모"]}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:s.admin_notes})})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(o,{to:d?"/admin":"/dashboard",className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors flex items-center space-x-2",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{children:d?"관리자 페이지로":"목록으로"})]}),e.jsxs("button",{onClick:()=>window.print(),className:"px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx("i",{className:"ri-printer-line"}),e.jsx("span",{children:"인쇄"})]})]}),d&&s.status==="pending"&&e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>D(s),className:"px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx("i",{className:"ri-check-line"}),e.jsx("span",{children:"승인"})]}),e.jsxs("button",{onClick:()=>I(s),className:"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors flex items-center space-x-2",children:[e.jsx("i",{className:"ri-close-line"}),e.jsx("span",{children:"반려"})]})]})]})]})]})}),N&&n&&e.jsx(O,{isOpen:N,onClose:()=>{p(!1),u(null)},onSave:M,currentNotes:n.admin_notes||"",companyName:`${n.company_name} - ${n.floor_number}층 ${n.room_number}호`,action:n.action})]})}export{B as default};
