import{a as q,u as C,r as i,j as e,L as h}from"./index-B-m7kj40.js";import{s as m,L as F}from"./Logo26Building-Cp1WG6XV.js";function M(){const{id:o}=q(),c=C(),[S,y]=i.useState(null),[E,I]=i.useState(null),[b,_]=i.useState(!1),[x,g]=i.useState(""),[D,j]=i.useState(!1),[s,d]=i.useState({company_name:"",business_type:"",tenant_type:"tenant",floor_number:"",room_number:"",move_in_date:"",contact_person:"",contact_phone:"",contact_email:"",employee_count:0,parking_needed:!1,parking_count:0,vehicle_numbers:[],special_requests:""});i.useEffect(()=>{o&&v()},[o]);const v=async()=>{try{const{data:{user:r}}=await m.auth.getUser();if(!r){c("/login");return}y(r);const{data:a}=await m.from("profiles").select("role").eq("id",r.id).single();j(a?.role==="admin");const{data:n}=await m.from("move_in_cards").select("user_id").eq("id",o).single();if(!n){c("/dashboard");return}if(a?.role!=="admin"&&n.user_id!==r.id){c("/dashboard");return}await N()}catch(r){console.error("Error checking user:",r),c("/login")}},N=async()=>{try{const{data:r,error:a}=await m.from("move_in_cards").select(`
          *,
          profiles(name, email, phone)
        `).eq("id",o).single();if(a)throw a;if(!r)throw new Error("입주카드를 찾을 수 없습니다.");d({company_name:r.company_name||"",business_type:r.business_type||"",tenant_type:r.tenant_type||"tenant",floor_number:r.floor_number||"",room_number:r.room_number||"",move_in_date:r.move_in_date||"",contact_person:r.contact_person||"",contact_phone:r.contact_phone||"",contact_email:r.contact_email||"",employee_count:r.employee_count||0,parking_needed:r.parking_needed||!1,parking_count:r.parking_count||0,vehicle_numbers:r.vehicle_numbers||[],special_requests:r.special_requests||""})}catch(r){g(r.message||"입주카드를 불러오는데 실패했습니다.")}},t=r=>{const{name:a,value:n,type:u}=r.target,p=r.target.checked;if(u==="checkbox")d(l=>({...l,[a]:p,...a==="parking_needed"&&!p?{vehicle_numbers:[]}:{}}));else if(u==="number"){const l=parseInt(n)||0;d(f=>({...f,[a]:l,...a==="parking_count"?{vehicle_numbers:f.vehicle_numbers.slice(0,l).concat(Array(Math.max(0,l-f.vehicle_numbers.length)).fill(""))}:{}}))}else d(l=>({...l,[a]:n}))},w=(r,a)=>{d(n=>({...n,vehicle_numbers:n.vehicle_numbers.map((u,p)=>p===r?a:u)}))},k=async r=>{r.preventDefault(),_(!0),g("");try{const a={company_name:s.company_name,business_type:s.business_type,tenant_type:s.tenant_type||"tenant",floor_number:s.floor_number,room_number:s.room_number,move_in_date:s.move_in_date,contact_person:s.contact_person,contact_phone:s.contact_phone,contact_email:s.contact_email,employee_count:s.employee_count||0,parking_needed:s.parking_needed||!1,parking_count:s.parking_needed&&s.parking_count||0,vehicle_numbers:s.vehicle_numbers||[],special_requests:s.special_requests,updated_at:new Date().toISOString()},{error:n}=await m.from("move_in_cards").update(a).eq("id",o);if(n)throw n;c(`/move-in-card/detail/${o}`)}catch(a){g(a.message||"입주카드 수정에 실패했습니다.")}finally{_(!1)}};return b&&!s.company_name?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-4xl text-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"입주카드를 불러오는 중..."})]})}):x&&!s.company_name?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"오류 발생"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x}),e.jsxs(h,{to:"/admin",className:"inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{children:"관리자 페이지로 돌아가기"})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(h,{to:"/",className:"flex items-center",children:e.jsx(F,{size:40})}),e.jsx("span",{className:"hidden sm:block text-gray-400",children:"|"}),e.jsx("span",{className:"hidden sm:block text-gray-600 font-medium",children:"입주카드 수정"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(h,{to:"/admin",className:"text-gray-600 hover:text-gray-900 transition-colors flex items-center space-x-1",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{className:"hidden sm:inline",children:"관리자 페이지"})]})})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-500 px-8 py-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"입주카드 수정"}),e.jsx("p",{className:"text-yellow-100",children:s.company_name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-yellow-600 text-white",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"수정 모드"]})})]})}),e.jsxs("form",{onSubmit:k,className:"p-8",children:[x&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:x})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-building-line mr-3 text-blue-600"}),"회사 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"company_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"회사명 *"}),e.jsx("input",{type:"text",name:"company_name",id:"company_name",required:!0,value:s.company_name,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"business_type",className:"block text-sm font-medium text-gray-700 mb-2",children:"업종 *"}),e.jsxs("select",{name:"business_type",id:"business_type",required:!0,value:s.business_type,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"",children:"업종을 선택하세요"}),e.jsx("option",{value:"IT/소프트웨어",children:"IT/소프트웨어"}),e.jsx("option",{value:"금융/보험",children:"금융/보험"}),e.jsx("option",{value:"제조업",children:"제조업"}),e.jsx("option",{value:"유통/물류",children:"유통/물류"}),e.jsx("option",{value:"서비스업",children:"서비스업"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_count",className:"block text-sm font-medium text-gray-700 mb-2",children:"직원 수"}),e.jsx("input",{type:"number",name:"employee_count",id:"employee_count",min:"0",value:s.employee_count,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-map-pin-line mr-3 text-blue-600"}),"입주 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"floor_number",className:"block text-sm font-medium text-gray-700 mb-2",children:"층수 *"}),e.jsx("input",{type:"text",name:"floor_number",id:"floor_number",required:!0,value:s.floor_number,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room_number",className:"block text-sm font-medium text-gray-700 mb-2",children:"호수 *"}),e.jsx("input",{type:"text",name:"room_number",id:"room_number",required:!0,value:s.room_number,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"move_in_date",className:"block text-sm font-medium text-gray-700 mb-2",children:"입주 예정일 *"}),e.jsx("input",{type:"date",name:"move_in_date",id:"move_in_date",required:!0,value:s.move_in_date,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-user-line mr-3 text-blue-600"}),"담당자 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700 mb-2",children:"담당자명 *"}),e.jsx("input",{type:"text",name:"contact_person",id:"contact_person",required:!0,value:s.contact_person,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact_phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"연락처 *"}),e.jsx("input",{type:"tel",name:"contact_phone",id:"contact_phone",required:!0,value:s.contact_phone,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact_email",className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일 *"}),e.jsx("input",{type:"email",name:"contact_email",id:"contact_email",required:!0,value:s.contact_email,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx("i",{className:"ri-car-line mr-3 text-blue-600"}),"주차 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"parking_needed",id:"parking_needed",checked:s.parking_needed,onChange:t,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"parking_needed",className:"ml-2 block text-sm text-gray-700",children:"주차 공간이 필요합니다"})]}),s.parking_needed&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"parking_count",className:"block text-sm font-medium text-gray-700 mb-2",children:"주차 공간 수"}),e.jsx("input",{type:"number",name:"parking_count",id:"parking_count",min:"0",value:s.parking_count,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),s.parking_count>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"ri-car-2-line mr-2 text-blue-600"}),"차량번호 입력"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:Array.from({length:s.parking_count},(r,a)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-8",children:[a+1,"번"]}),e.jsx("input",{type:"text",value:s.vehicle_numbers[a]||"",onChange:n=>w(a,n.target.value),className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-gray-900 placeholder-gray-400",placeholder:`차량번호 ${a+1} (예: 12가3456)`})]},a))}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"차량번호는 한글, 숫자, 영문을 포함하여 입력해주세요 (예: 12가3456, 123가4567)"]})]})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center mb-4",children:[e.jsx("i",{className:"ri-message-3-line mr-3 text-blue-600"}),"특별 요청사항"]}),e.jsx("textarea",{name:"special_requests",id:"special_requests",rows:4,value:s.special_requests,onChange:t,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",placeholder:"특별한 요청사항이 있으시면 입력해주세요..."})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200 flex justify-end space-x-4",children:[e.jsxs(h,{to:"/admin",className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors flex items-center space-x-2",children:[e.jsx("i",{className:"ri-arrow-left-line"}),e.jsx("span",{children:"취소"})]}),e.jsx("button",{type:"submit",disabled:b,className:"px-8 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-xl hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 transform hover:scale-105 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin"}),e.jsx("span",{children:"수정 중..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line"}),e.jsx("span",{children:"수정 완료"})]})})]})]})]})})]})}export{M as default};
