import{r as i,u as Q,j as e,L as d}from"./index-Drgjiqtk.js";import{s as x,L as W}from"./Logo26Building-GQmdfOri.js";import{A as G}from"./AdminNotesModal-Dxgr8P20.js";function Z(){const[H,L]=i.useState(null),[k,S]=i.useState(null),[f,_]=i.useState([]),[N,D]=i.useState([]),[M,E]=i.useState(!0),[u,I]=i.useState("all"),[a,h]=i.useState(""),[n,p]=i.useState(""),[J,b]=i.useState(""),[O,v]=i.useState(!1),[c,y]=i.useState(null),[$,g]=i.useState(!1),[o,j]=i.useState(null),w=Q();i.useEffect(()=>{F()},[]),i.useEffect(()=>{let s=f;if(u!=="all"&&(s=s.filter(t=>t.status===u)),a.trim()){const t=a.toLowerCase();s=s.filter(r=>r.company_name?.toLowerCase().includes(t)||r.contact_person?.toLowerCase().includes(t)||r.contact_email?.toLowerCase().includes(t)||r.contact_phone?.toLowerCase().includes(t)||r.business_type?.toLowerCase().includes(t)||r.floor_number?.toLowerCase().includes(t)||r.room_number?.toLowerCase().includes(t)||r.profiles?.name?.toLowerCase().includes(t)||r.profiles?.email?.toLowerCase().includes(t))}if(n.trim()){const t=n.toLowerCase();s=s.filter(r=>r.room_number?.toLowerCase().includes(t)||r.floor_number?.toLowerCase().includes(t))}D(s)},[f,u,a,n]);const F=async()=>{try{const{data:{user:s}}=await x.auth.getUser();if(!s){w("/login");return}L(s);const{data:t}=await x.from("profiles").select("*").eq("id",s.id).single();if(!t||t.role!=="admin"){w("/dashboard");return}S(t),await C()}catch(s){console.error("Error:",s)}finally{E(!1)}},C=async()=>{try{console.log("Loading move-in cards...");const{data:s,error:t}=await x.from("move_in_cards").select(`
          *,
          profiles(name, email, phone)
        `).order("created_at",{ascending:!1});if(console.log("Query result:",{data:s,error:t}),t){console.error("Supabase error:",t),b("입주카드를 불러오는데 실패했습니다: "+t.message);return}s?(console.log("Loaded cards:",s.length),_(s)):(console.log("No data returned"),_([]))}catch(s){console.error("Error loading cards:",s),b("입주카드를 불러오는데 실패했습니다.")}},q=async(s,t,r)=>{try{const{error:l}=await x.from("move_in_cards").update({status:t,admin_notes:r||null,updated_at:new Date().toISOString()}).eq("id",s);if(l)throw l;await C()}catch(l){console.error("Error updating status:",l)}},R=s=>{switch(s){case"approved":return"승인됨";case"rejected":return"반려됨";case"pending":default:return"대기중"}},T=s=>{y({...s,action:"approve"}),v(!0)},A=s=>{y({...s,action:"reject"}),v(!0)},B=s=>{if(c){const t=c.action;q(c.id,t==="approve"?"approved":"rejected",s)}},U=s=>{j(s),g(!0)},z=async()=>{if(o)try{const{error:s}=await x.from("move_in_cards").delete().eq("id",o.id);if(s)throw s;await C(),g(!1),j(null),console.log("입주카드가 성공적으로 삭제되었습니다.")}catch(s){console.error("Error deleting card:",s),b("입주카드 삭제에 실패했습니다.")}},K=async()=>{await x.auth.signOut(),w("/")},P=s=>{const r={pending:{text:"검토중",class:"bg-yellow-100 text-yellow-800"},approved:{text:"승인됨",class:"bg-green-100 text-green-800"},rejected:{text:"반려됨",class:"bg-red-100 text-red-800"}}[s];return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.class}`,children:r.text})},m=s=>{let t=f;if(a.trim()){const r=a.toLowerCase();t=t.filter(l=>l.company_name?.toLowerCase().includes(r)||l.contact_person?.toLowerCase().includes(r)||l.contact_email?.toLowerCase().includes(r)||l.contact_phone?.toLowerCase().includes(r)||l.business_type?.toLowerCase().includes(r)||l.floor_number?.toLowerCase().includes(r)||l.room_number?.toLowerCase().includes(r)||l.profiles?.name?.toLowerCase().includes(r)||l.profiles?.email?.toLowerCase().includes(r))}if(n.trim()){const r=n.toLowerCase();t=t.filter(l=>l.room_number?.toLowerCase().includes(r)||l.floor_number?.toLowerCase().includes(r))}return s==="all"?t.length:t.filter(r=>r.status===s).length};return M?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"로딩 중..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{to:"/",className:"flex items-center",children:e.jsx(W,{size:40})}),e.jsx("span",{className:"ml-4 text-gray-600",children:"관리자 대시보드"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d,{to:"/admin/notices",className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium cursor-pointer whitespace-nowrap flex items-center space-x-2",children:[e.jsx("i",{className:"ri-notification-line"}),e.jsx("span",{children:"공지사항 관리"})]}),e.jsxs(d,{to:"/admin/complaints",className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium cursor-pointer whitespace-nowrap flex items-center space-x-2",children:[e.jsx("i",{className:"ri-customer-service-line"}),e.jsx("span",{children:"민원 관리"})]}),e.jsxs(d,{to:"/admin/move-in-card/new",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium cursor-pointer whitespace-nowrap flex items-center space-x-2",children:[e.jsx("i",{className:"ri-add-line"}),e.jsx("span",{children:"새 입주카드"})]}),e.jsxs("span",{className:"text-gray-700",children:["관리자: ",k?.name,"님"]}),e.jsx("button",{onClick:K,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium cursor-pointer whitespace-nowrap",children:"로그아웃"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-4 mb-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"전체"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:m("all")})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-time-line text-2xl text-yellow-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"검토중"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:m("pending")})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-check-line text-2xl text-green-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"승인됨"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:m("approved")})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-close-line text-2xl text-red-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"반려됨"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:m("rejected")})]})})]})})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{key:"all",label:"전체"},{key:"pending",label:"검토중"},{key:"approved",label:"승인됨"},{key:"rejected",label:"반려됨"}].map(s=>e.jsxs("button",{onClick:()=>I(s.key),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm cursor-pointer ${u===s.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.label," (",m(s.key),")"]},s.key))})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"입주카드 검색"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"ri-search-line text-gray-400"})}),e.jsx("input",{type:"text",id:"search",value:a,onChange:s=>h(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"회사명, 담당자명, 이메일, 전화번호로 검색..."}),a&&e.jsx("button",{onClick:()=>h(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("i",{className:"ri-close-line text-gray-400 hover:text-gray-600"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"roomSearch",className:"block text-sm font-medium text-gray-700 mb-2",children:"호수 검색"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"ri-building-line text-gray-400"})}),e.jsx("input",{type:"text",id:"roomSearch",value:n,onChange:s=>p(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"호수 또는 층수로 검색 (예: 501, 5층)"}),n&&e.jsx("button",{onClick:()=>p(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("i",{className:"ri-close-line text-gray-400 hover:text-gray-600"})})]})]})]}),(a||n)&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-search-line text-blue-500 mr-2"}),e.jsxs("span",{className:"text-sm text-blue-700",children:[a&&`"${a}"`,a&&n&&" + ",n&&`호수: "${n}"`," ","검색 결과: ",N.length,"개"]}),(a||n)&&e.jsx("button",{onClick:()=>{h(""),p("")},className:"ml-3 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"전체 초기화"})]})})]}),N.length===0?e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 text-center",children:[e.jsx("i",{className:"ri-file-list-3-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:a||n?"검색 결과가 없습니다":"입주카드가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:a||n?"검색 조건에 맞는 입주카드가 없습니다. 다른 검색어를 시도해보세요.":"해당 상태의 입주카드가 없습니다."}),(a||n)&&e.jsx("button",{onClick:()=>{h(""),p("")},className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"검색 초기화"})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:N.map(s=>e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-blue-600 truncate",children:s.company_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["신청자: ",s.profiles?.name," (",s.profiles?.email,")"]})]}),P(s.status)]}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"업종:"})," ",s.business_type]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"위치:"})," ",s.floor_number,"층 ",s.room_number,"호"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"입주일:"})," ",new Date(s.move_in_date).toLocaleDateString("ko-KR")]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"직원 수:"})," ",s.employee_count,"명"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"주차:"})," ",s.parking_needed?`${s.parking_count}대 필요`:"불필요"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"신청일:"})," ",new Date(s.created_at).toLocaleDateString("ko-KR")]})]})]}),s.special_requests&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"특별 요청사항:"})," ",s.special_requests]})}),s.admin_notes&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"관리자 메모:"})," ",s.admin_notes]})})]}),e.jsxs("div",{className:"ml-4 flex-shrink-0 flex space-x-2",children:[e.jsx(d,{to:`/move-in-card/${s.id}`,className:"text-blue-600 hover:text-blue-500 cursor-pointer px-3 py-1 rounded text-sm transition-colors duration-200",title:"상세보기",children:e.jsx("i",{className:"ri-eye-line text-lg"})}),e.jsx(d,{to:`/move-in-card/edit/${s.id}`,className:"text-yellow-600 hover:text-yellow-500 cursor-pointer px-3 py-1 rounded text-sm transition-colors duration-200",title:"수정",children:e.jsx("i",{className:"ri-edit-line text-lg"})}),e.jsx("button",{onClick:()=>U(s),className:"text-red-600 hover:text-red-500 cursor-pointer px-3 py-1 rounded text-sm transition-colors duration-200",title:"삭제",children:e.jsx("i",{className:"ri-delete-bin-line text-lg"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(s),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm cursor-pointer whitespace-nowrap transition-colors duration-200",children:"승인"}),e.jsx("button",{onClick:()=>A(s),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm cursor-pointer whitespace-nowrap transition-colors duration-200",children:"반려"})]})]})]})})},s.id))})})]})}),e.jsx(G,{isOpen:O,onClose:()=>{v(!1),y(null)},onSave:B,currentNotes:c?.admin_notes||"",companyName:c?.company_name||"",action:c?.action||"approve"}),$&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all duration-300 scale-100",children:[e.jsx("div",{className:"bg-red-500 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"입주카드 삭제"}),e.jsx("p",{className:"text-red-100 text-sm mt-1",children:o.company_name})]}),e.jsx("button",{onClick:()=>{g(!1),j(null)},className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"정말로 이 입주카드를 삭제하시겠습니까?"}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"회사명:"})," ",o.company_name,e.jsx("br",{}),e.jsx("strong",{children:"업종:"})," ",o.business_type,e.jsx("br",{}),e.jsx("strong",{children:"상태:"})," ",R(o.status)]})}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"⚠️ 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{g(!1),j(null)},className:"flex-1 px-4 py-3 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors duration-200",children:"취소"}),e.jsx("button",{onClick:z,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-all duration-200 transform hover:scale-105",children:"삭제"})]})]})]})})]})}export{Z as default};
