import{r as t,u as P,j as e,L as i}from"./index-B-m7kj40.js";import{s as a,L as $}from"./Logo26Building-Cp1WG6XV.js";function T(){const[n,f]=t.useState(null),[x,p]=t.useState(null),[u,j]=t.useState([]),[y,m]=t.useState(!0),[g,o]=t.useState(""),[c,N]=t.useState("all"),h=P();t.useEffect(()=>{v()},[]),t.useEffect(()=>{x&&n&&w()},[x,n,c]);const v=async()=>{try{const{data:{user:s}}=await a.auth.getUser();if(!s){h("/login");return}f(s);const{data:l,error:r}=await a.from("profiles").select("*").eq("id",s.id).single();if(r)throw r;p(l)}catch(s){console.error("사용자 확인 오류:",s),o("사용자 정보를 확인하는데 실패했습니다.")}finally{m(!1)}},w=async()=>{try{if(m(!0),o(""),!n?.id){o("사용자 정보가 없습니다.");return}let s=a.from("complaints").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});c!=="all"&&(s=s.eq("status",c));const{data:l,error:r}=await s;if(r)throw console.error("Supabase 오류:",r),r;const L=await Promise.all((l||[]).map(async d=>{const{data:q}=await a.from("profiles").select("name, email").eq("id",d.user_id).single(),{data:D}=d.admin_id?await a.from("profiles").select("name, email").eq("id",d.admin_id).single():{data:null};return{...d,profiles:q,admin_profiles:D}}));j(L)}catch(s){console.error("민원 목록 로딩 오류:",s),o(`민원 목록을 불러오는데 실패했습니다: ${s instanceof Error?s.message:"알 수 없는 오류"}`)}finally{m(!1)}},_=s=>{switch(s){case"pending":return"접수됨";case"in_progress":return"처리중";case"resolved":return"해결됨";case"closed":return"종료됨";default:return s}},S=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},C=s=>{switch(s){case"low":return"text-green-600";case"normal":return"text-blue-600";case"high":return"text-orange-600";case"urgent":return"text-red-600";default:return"text-gray-600"}},k=s=>({facility:"시설 관련",security:"보안 관련",noise:"소음 관련",parking:"주차 관련",elevator:"엘리베이터",cleaning:"청소 관련",management:"관리사무소",other:"기타"})[s]||s,b=s=>new Date(s).toLocaleDateString("ko-KR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=async()=>{await a.auth.signOut(),h("/")};return y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})})}):g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:g}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200",children:"새로고침"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx(i,{to:"/",className:"flex items-center space-x-3",children:e.jsx($,{size:40})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(i,{to:"/dashboard",className:"text-gray-600 hover:text-gray-900 font-medium",children:"대시보드"}),e.jsx(i,{to:"/",className:"text-gray-600 hover:text-gray-900 font-medium",children:"홈으로"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("span",{className:"text-gray-600",children:x?.name||"사용자"}),e.jsx("button",{onClick:E,className:"text-red-600 hover:text-red-700 font-medium",children:"로그아웃"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"민원접수"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"26빌딩 관련 민원을 확인하고 관리하세요."})]}),e.jsxs(i,{to:"/complaints/new",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2",children:[e.jsx("i",{className:"ri-add-line"}),"새 민원 접수"]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex space-x-2",children:[{value:"all",label:"전체"},{value:"pending",label:"접수됨"},{value:"in_progress",label:"처리중"},{value:"resolved",label:"해결됨"},{value:"closed",label:"종료됨"}].map(s=>e.jsx("button",{onClick:()=>N(s.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${c===s.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},s.value))})}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-customer-service-line text-6xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"민원이 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"새로운 민원을 접수해보세요."}),e.jsx(i,{to:"/complaints/new",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200",children:"첫 민원 접수하기"})]}):u.map(s=>e.jsx("div",{className:"block group",children:e.jsx("div",{className:"border border-gray-200 rounded-xl p-6 hover:border-blue-300 hover:shadow-md transition-all duration-200 group-hover:bg-blue-50/30",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${S(s.status)}`,children:_(s.status)}),e.jsx("span",{className:`text-sm font-medium ${C(s.priority)}`,children:s.priority==="low"?"낮음":s.priority==="normal"?"보통":s.priority==="high"?"높음":"긴급"}),e.jsx("span",{className:"text-sm text-gray-500",children:k(s.category)}),s.is_anonymous&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx("i",{className:"ri-eye-off-line mr-1"}),"익명"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors duration-200 mb-2",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2 mb-3",children:s.content}),s.admin_response&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("i",{className:"ri-customer-service-2-line text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"관리자 답변"})]}),e.jsx("p",{className:"text-sm text-blue-800 line-clamp-1",children:s.admin_response})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:b(s.created_at)}),s.response_date&&e.jsxs("span",{children:["답변: ",b(s.response_date)]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsx("i",{className:"ri-arrow-right-s-line text-lg group-hover:translate-x-1 transition-transform duration-200 text-gray-400"})})]})})},s.id))})]})})]})}export{T as default};
